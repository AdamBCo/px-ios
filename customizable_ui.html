<!DOCTYPE html>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  <title>Customizable UI</title>
  </head>
  <body>
    <header>
      <div class="inner">
          <img src="images/logo-mercadopago.png" alt="logoMp">

          <div class="right">
              <img class="centered" src="images/logo_ios.png" alt="logoiOS" height="50" width="50">
          </div>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>Customizable UI</h1>
          <h2>Overview</h2>
          <p>In order to make a payment and get payments information you need to set the MercadoPagoContext with your public key and access token at least. According to the information you would like to retrieve you will need to configure other settings (this will be specified for each case)</p>
          <pre class="prettyprint">
            MercadoPagoContext.setPublicKey("public_key")
            MercadoPagoContext.setMerchantAccessToken("access_token")
          </pre>

          <p>After this, you can use <b>MPServicesBuilder</b> to request any resource you need. In the next section you will find all the services available for you to use.</p>

          <h2>Getting data</h2>
          <h3>Payment methods</h3>
          <p>To get available payment methods, you could use this method:</p>
          <pre class="prettyprint">
            MPServicesBuilder.getPaymentMethods({ (paymentMethods) -> Void in
                // Here you get the list of the paymentMethods available for your country!
                }, failure: { (error) -> Void in
                    // An error ocurred! :( Handle it here
            })
          </pre>
          <br>
          <h3>Issuers</h3>
          <p>If you want to offer installments for your payments, you need to know your user’s card issuer. However, it may not be necessary to ask for it: once your user selected a payment method, you can check if the issuer is automatically determined or not by this  method in the PaymentMethod class:</p>
          <pre class="prettyprint">
              paymentMethod.isIssuerRequired()
          </pre>

          <p>Then, if you have to ask for it, retrieve a list of issuers like this:</p>
          <pre class="prettyprint">
            MPServicesBuilder.getIssuers(paymentmethodId, success: { (issuers) -> Void in
                // Here you get the list of the issuers available for the paymentmethodId given
                }, failure: { (error) -> Void in
                    // Handle error here
            })
          </pre>
          <br>
          <h3>Card data management</h3>
          <p>In your card data form, you need to get your user’s identification number. We provide tools to validate it. First, get the available identification types:</p>
          <pre class="prettyprint">
            MPServicesBuilder.getIdentificationTypes({ (identificationTypes) -> Void in
              //Here you get a list of identificationTypes available
            }, failure: { (error) -> Void in
                // Handle error here
            })
          </pre>

          <p>When card data is entered, you must create a <i><b>CardToken</b></i> object, getting the filled information:</p>
          <pre class="prettyprint">
            let cardToken = CardToken(cardNumber: "cardNumber", expirationMonth: 1, expirationYear: 2020, securityCode: "123", cardholderName: "cardholderName", docType: "docType", docNumber: "docNumber")
          </pre>

          <p>The <i><b>CardToken</b></i> class provides card validation methods for the card’s data:</p>
          <p>For number and the security code, our SDK checks consistency between the chosen payment method and the card data:</p>
          <p><b>Card number validation:</b></p>
          <pre class="prettyprint">
            cardToken.validateCardNumber()
          </pre>

          <p><b>Security code validation:</b></p>
          <pre class="prettyprint">
            cardToken.validateSecurityCode()
          </pre>

          <p>Both methods will throw exceptions if an invalid data was entered.</p>
          <p><b>Expiry date validation:</b></p>
          <pre class="prettyprint">
            cardToken.validateExpiryDate()
          </pre>

          <p><b>Holder name validation:</b></p>
          <pre class="prettyprint">
            cardToken.validateCardholderName()
          </pre>

          <p><b>Validation for identification number and type:</b></p>
          <pre class="prettyprint">
            cardToken.validateIdentificationType()
            cardToken.validateIdentificationNumber()
          </pre>

          <p>After validated, with this <i><b>CardToken</b></i>, you’ll be able to generate a <i><b>Token</b></i> object, that will be necessary to <a href="make_payment.html">create a payment.</a></p>
          <br>
          <h3>Installments</h3>
          <p>Once you have the PaymentMethod and, if required, the issuer, you can get the installments available for your client providing the BIN (first six digits of the card number), amount to pay, the issuer’s id and the payment type id. Do this:</p>
          <pre class="prettyprint">
            MPServicesBuilder.getInstallments("bin", amount: 1.0, issuer: issuer, paymentTypeId: PaymentTypeId.CREDIT_CARD, success: { (installments) -> Void in
              if installments.count > 0 && installments[0].payerCosts != nil {
                let payerCosts = installments[0].payerCosts // Use the payerCosts to retrieve the installments info
              }
            }, failure: { (error) -> Void in
              // Handle error here
            })
          </pre>

          <p>An installment has information about the payment method, the issuer and a list of <b>payer costs</b>, that you’ll have to show to your clients in order to make them choose. </p>
          <p><b><i>PayerCost</i></b> object has a <b><i>recommended message</i></b>, that you should show to your user when they have to choose (it has a calculated amount by number of installments so you don’t have to make calculations in your app, that may have rounding errors).</p>
          <p>In the payerCost object you will find information related to minAllowedAmount, installmentAmount, etc</p>
          <br>

          <h3>Customer’s saved cards. </h3>
          <br>
          <p>With MercadoPago SDK, you can manage your customer's information easily. By giving to each customer an id and syncing it with MercadoPago, we can handle your users information (preferred cards, address, name, email, etc.). In order to do this, you’ll have to set up your server with <a href="https://www.mercadopago.com.ar/developers/es/tools/">MercadoPago Server SDK</a>.
          <br>
          Then, to get your Customer object in your app, just do this:</p>
          <br>
          <pre class="prettyprint">
            //Set your server customer uri to get the customers information and access token
            MercadoPagoContext.setCustomerURI("customer_uri")
            MercadoPagoContext.setMerchantAccessToken("access_token")

            MerchantServer.getCustomer("merchantBaseUrl", success: { (customer: Customer) -> Void in
               let cards = customer.cards // Here you obtain the customer cards
               }, failure: { (error: NSError?) -> Void in
                   // Handle error here
              })
          </pre>

          <p>Make your user choose one of it’s saved cards. Ask for the security code  and then create a <b><i>SavedCardToken</i></b>:</p>
          <pre class="prettyprint">
            let savedCardToken = SavedCardToken(card: creditCardSelected, securityCode: "123", securityCodeRequired: true)
          </pre>

          <p>Then, validate the security code and cardId:</p>
          <pre class="prettyprint">
            savedCardToken.validate()
          </pre>

          <p>The method validate() will return false in case the savedCardToken is invalid.</p>
          <br>
          <h3>Get a token</h3>
          <br>
          <p>Just do this, providing the information you gathered:</p>
          <p>If you created a <b><i>CardToken</i></b>:</p>
          <pre class="prettyprint">
            MPServicesBuilder.createNewCardToken(cardtoken, success: { (token) -> Void in
                        // Here you obtain the card token
                        }) { (error) -> Void in
                            // Handle error here
                    }
          </pre>

          <p>Or if you created a <b><i>SavedCardToken</i></b>:</p>
          <pre class="prettyprint">
            MPServicesBuilder.createToken(savedCardToken, success: {(token: Token?) -> Void in
                        var tokenId : String? = nil
                        if token != nil {
                            tokenId = token!._id
                        }

                        let installments = self.selectedPayerCost == nil ? 0 : self.selectedPayerCost!.installments

                        }, failure: { (error: NSError?) -> Void in
                            // Handle error here
                    })
          </pre>
          <br>
          <h3>Bank deals</h3>
          <p>Get available promotions easilly adding this to your code:</p>
          <pre class="prettyprint">
            MPServicesBuilder.getPromos({ (promos) -> Void in
                // Use promos list with all bank promotions available
            }, failure: { (error) -> Void in
              // Handle error here
            })
          </pre>

          <p>Bank deals have “legals”, which are basically the terms and conditions of the promotion.</p>
          <h2>Make a payment</h2>
          <p>Once you got all the necessary information, see how to <a href="make_payment.html">make a payment</a> and end your flow.</p>
          <h2>Extras</h2>
          <h3>Payment method detection by card BIN</h3>
          <p>If you want to ask for card data before anything else, you could filter the valid payment methods for that card's BIN from the list that MercadoPago class gives you by with this method:</p>
          <pre class="prettyprint">
            List&lt;PaymentMethod&gt; paymentMethods = mercadoPago.getPaymentMethodsForBin(bin, paymentMethods, supportedPaymentTypes);
          </pre>
          <p><b>Tip:</b> to filter payment methods by their type, create a list of strings that let you filter by:<br>
            <i>Credit card: “credit_card”<br>
            Debit card: “debit_card”<br></i>
            <br>
            <b>Example:</b>
            <pre class="prettyprint">
            protected List&lt;String&gt; supportedPaymentTypes = new ArrayList&lt;String&gt;(){{
               add("credit_card");
               add("debit_card");
            }};
            </pre>

            <h3>Payment Types Available</h3>
            <p>You can retrieve the payment types available accessing an enum <b>PaymentTypeId</b>:</p>
            <pre class="prettyprint">
              public enum PaymentTypeId :String {
                case DEBIT_CARD = "debit_card"
                case CREDIT_CARD = "credit_card"
                case ACCOUNT_MONEY = "account_money"
                case TICKET = "ticket"
                case BANK_TRANSFER = "bank_transfer"
                case ATM = "atm"
                case BITCOIN = "bitcoin"
                case PREPAID_CARD = "prepaid_card"
              }
            </pre>
            <p>Keep in mind payment types <i>are not the same as payment methods</i>. We provide information about <a href="payment_types_available.html">payment methods and payment types available</a></p>

            <h3>Payment Groups Used in Checkout</h3>
            <p>If you would like to retrieve the payment methods description as we do in <a href="checkout_flow.html"> the checkout flow</a>, you can use the following service.</p>
            <p>Even though it is available for you to use, we discourage this implementation because its complexity. In case you want to retrieve payment methods like the checkout flow we provide, we insist you use the <a href="checkout_flow.html">checkout flow solution</a> to avoid errors or confusions.
            <pre class="prettyprint">
              MPServicesBuilder.searchPaymentMethods(excludedPaymentTypes, excludedPaymentMethods: excludedPaymentMethods, success: { (paymentMethodSearchResponse: PaymentMethodSearch) -> Void in
                  //The object PaymentMethodSearch contains a tree structure with all the payment methods and types filtered
                }, failure: { (error) -> Void in
                  // Handle error
            })
            </pre>

          </pre>
          <p>Keep in mind payment types <i>are not the same as payment methods</i>. We provide information about <a href="payment_types_available.html">payment methods and payment types available</a></p>

          <h3>Instructions for offline payment method</h3>
          <p>When a buyer pays with an offline payment method such as ticket or bank transfer, you need to show him instructions with the steps needed to complete the payment.</p>
          <p>To retrieve the instructions according to the payment, you can use the following service:</p>
          <pre class="prettyprint">
            MPServicesBuilder.getInstructionsByPaymentId(payment, success: { (instruction : Instruction) -> Void in
                // In the instruction object you have all the information to display the correct instructions according to the payment details
                }, failure: { (error) -> Void in
                    // Handle error here
            })
          </pre>
          <p>The payment object is obtained when you <a href="make_a_payment.html">make a payment</a></p>

        <aside id="sidebar">
          <a href="https://github.com/mreverter/sdk-android" class="button"><small>View project on</small> GitHub</a>

          <a href="https://github.com/mreverter/sdk-android/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/mreverter/sdk-android/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/mreverter/sdk-android"></a> is maintained by <a href="https://github.com/mreverter">mreverter</a>.</p>
        </aside>
      </div>

    </div>
    </div>
    </section>
  </body>
</html>
