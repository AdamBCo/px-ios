<!DOCTYPE html>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  <title>Complete Checkout flow solution</title>
  </head>

  <body>
    <header>
      <div class="inner">
          <img src="images/logo-mercadopago.png" alt="logoMp">

          <div class="right">
              <img class="centered" src="images/logo_ios.png" alt="logoiOS" height="50" width="50">
          </div>
      </div>
    </header>
    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <div>
            <h1>Complete Checkout flow tool</h1>
          </div>

          <div>
            <h3>Create a Checkout Preference</h3>
            <p>First you need to create a checkout preference with all payment related information: </p>
            <pre class="prettyprint">
              // Create items to purchase
              let item : Item = Item(_id: "itemId", quantity: 2,
              unitPrice: 10)
              var items = [Item]()
              items.append(item)

              //Create Payer
              let payer = Payer(_id : 1, email : "thisis@nemail.com")

              //Create payment methods constraints if needed
              let preferencePaymentMethods = PreferencePaymentMethods(excludedPaymentMethods: ["amex"], excludedPaymentTypes: [PaymentTypeId.ATM], defaultPaymentMethodId: nil, installments: 1, defaultInstallments: 1)

              //Create shipment information

              //Create CheckoutPreference
              let preference = CheckoutPreference(items: items, payer: payer, paymentMethods: preferencePaymentMethods)

          </pre>
          <p>The preference payment methods will exclude those payment methods or types you don't want to display in your app. This property is not mandatory. You can check our <a href="payment_types_available.html">payment methods and payment types availables</a> for more information.</p>
          </div>

          <div>
            <h3/>Configure server settings</h3>
            <p>Now you need to create the preference in Mercado Pago to start the checkout flow.</p>
            <p>In order to do this, youâ€™ll have to set up your server with <h ref="https://www.mercadopago.com.ar/developers/es/tools/">MercadoPago Server SDK</h>, and then add your base URL, preference URI and access token:</p>
            <pre class="prettyprint">

              MercadoPagoContext.
                setMerchantAccessToken(--YOUR ACCESS TOKEN--)

              MercadoPagoContext.
                setBaseURL(-- YOUR BASE URL --)

              MercadoPagoContext.
                setPreferenceURI(-- YOUR Preference URI --)

            </pre>
            <p><b>Note:</b> If you do not set the <b>base url of your server</b> and <b>preference uri</b>, the checkout preference will be created in Mercado Pago without sending any information to your server.</p>
          </div>

          <div>
            <h3>Send checkout preference and start checkout flow</h3>
            <p>Once you have your server settings configured (or not in case you just want to post the preference into mercado pago), you need to send the checkout preference and start the checkout flow with the preference retrieved:</p>

            <pre class="prettyprint">
              MerchantServer.createPreference(preference: preference, success: { (checkoutPreference) -> Void in
                //Display the checkout flow
                self.navigationViewController.pushViewController(MPFlowBuilder.starCheckoutViewController(preference, callback: { (merchantPayment : MerchantPayment) -> Void in
                    //Payment is completed! You can get the payment data from merchantPayment
                }), animated: true)
              }, failure: { (error) -> Void in
                  //Handle error creating preference
              })
            </pre>

            <p>Keep in mind that the line <h style="color:blue">MPFlowBuilder.starCheckoutViewController</h> returns a <h style="color:blue">UIViewController</h>. You can start the checkout flow at any point with this line only, but always with the checkout preference created with a proper id as a parameter.</p>


          <p><b>Let's take a look!</b></p>
          <p>First the user selects how he would like to pay (the payment methods available will differ according to your country or your preference settings): </p>
          <img class="centered" src="images/iosScreens/payment_method_search_main.png" alt="pm_list">
          <br>
          <p>Next step: CC && ATM && CONFIRM </p>

        </section>


      </div>
    </div>
  </body>
</html>
