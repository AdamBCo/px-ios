<!DOCTYPE html>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="css/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  <title>Complete Checkout flow solution</title>
  </head>

  <body>
    <header>
      <div class="inner">
          <img src="images/logo-mercadopago.png" alt="logoMp">

          <div class="right">
              <img class="centered" src="images/logo_ios.png" alt="logoiOS" height="50" width="50">
          </div>
      </div>
    </header>
    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

          <h1>Complete Checkout flow tool</h1>

          <div>
            <p>First you need to create a checkout preference with all payment related information: </p>
            <pre class="prettyprint">
              // Create items to purchase
              let item : Item = Item(_id: "itemId", quantity: 2,
              unitPrice: 10)
              var items = [Item]()
              items.append(item)

              //Create Payer
              let payer = Payer(_id : 1, email : "thisis@nemail.com")

              //Create payment methods constraints if needed

              //Create shipment information

              //Create CheckoutPreference
              let preference = CheckoutPreference(items: items, payer: payer)

          </pre>
          </div>

          <div>
            <p>Now you need to create the preference in Mercado Pago to start the checkout flow.</p>
            <p>In order to do this, you’ll have to set up your server with MercadoPago Server SDK, and then add your base URL, and preference URI and access token:</p>
            <pre class="prettyprint">

              MercadoPagoContext.
                setMerchantAccessToken(--YOUR ACCESS TOKEN--)

              MercadoPagoContext.
                setBaseURL(-- YOUR BASE URL --)

              MercadoPagoContext.
                setPreferenceURI(-- YOUR Preference URI --)

            </pre>
            <p><b>Note:</b> If you do not set the <b>base url of your server</b> and <b>preference uri</b>, the checkout preference will be created in Mercado Pago without sending any information to your server.</p>

            <p>Now you have to send the checkout preference to your server and start the checkout flow with the preference retrieved:</p>

            <pre class="prettyprint">
              MerchantServer.createPreference(preference: preference, success: { (checkoutPreference) -> Void in
                //Display the checkout flow
                self.navigationViewController.pushViewController(MPFlowBuilder.starCheckoutViewController(preference, callback: { (merchantPayment : MerchantPayment) -> Void in
                    //Payment is completed! You can get the payment data from merchantPayment
                }), animated: true)
              }, failure: { (error) -> Void in
                  //Handle error creating preference
              })
            </pre>

            <p>Keep in mind that the line <h style="color:blue">MPFlowBuilder.starCheckoutViewController</h> returns a <h style="color:blue">UIViewController</h>. You can start the checkout flow at any point with this line only, but always with the checkout preference created with a proper id as a parameter.</p>

        
          <p><b>Let's see!</b></p>
          <p>First the user selects a payment method:</p>
          <img class="centered" src="images/iosScreens/select_pm.png" alt="pm_list">
          <br>
          <p>Next step: add card information</p>
          <img class="centered" src="images/iosScreens/card_form.png" alt="new_card">
          <br>
          <p>Check information before paying:</p>
          <img class="centered" src="images/iosScreens/confirm_payment.png" alt="confirm_payment">
          <br>
          <h2>Merchant’s customers</h2>

          <p>With MercadoPago SDK, you can manage your customer's information easily.
            By giving to each customer an id and syncing it with MercadoPago, we can handle your users information
            (preferred cards, address, name, email, etc.).
            In order to do this, you’ll have to set up your server with
            <a href="https://www.mercadopago.com.ar/developers/es/tools/">MercadoPago Server SDK</a>,
            and then add <b>your base URL</b>,
            customer URI and access token:</p>

          <pre class="prettyprint">

            MercadoPagoContext.
              setMerchantAccessToken(--YOUR ACCESS TOKEN--)

            MercadoPagoContext.
              setBaseURL(-- YOUR BASE URL --)

            MercadoPagoContext.
              setCustomerURI(-- YOUR CUSTOMER URI --)

          </pre>
          <br>
          <p>When registered customer’s saved cards are found, this flavor takes the default one and starts the payment flow showing it:</p>
          <img class="centered" src="images/screenshots/customer_card.png" alt="customer_card">
          <p class="image_footer">Saved card example</p>
          <br>
          <p>When touching on the saved card, another screen with a list of the customer’s saved cards is shown.<br>
          If a new card is needed, the user can start the data-collection flow (it’s up to you whether to use the step by step flow or guessing form).
          </p>

          <img class="centered" src="images/screenshots/other_pm_selection.png" alt="other_pm_selection">
          <p class="image_footer">A list of saved cards would be shown here, and also the option to pay in another way
          </p>
          <br>
          <p>And finally, you get in the callback the information to make a payment...</p>

          <p>To create a payment, have a look at: <a href="make_payment.html">Make a payment</a></p>

        </section>


      </div>
    </div>
  </body>
</html>
